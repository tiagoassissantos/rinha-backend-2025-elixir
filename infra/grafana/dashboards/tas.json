{
  "__note": "This file duplicates infra/grafana-dashboard.json for provisioning convenience.",
  "__source": "infra/grafana-dashboard.json",
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": "-- Grafana --",
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "type": "timeseries",
      "title": "HTTP RPS (by method/status)",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
      "targets": [
        {
          "expr": "sum by (method, status) (rate(tas_rinhaback_3ed_prom_ex_plug_router_http_requests_total[1m]))",
          "legendFormat": "{{method}} {{status}}"
        }
      ],
      "fieldConfig": {"defaults": {"unit": "req/s"}, "overrides": []}
    },
    {
      "type": "timeseries",
      "title": "HTTP latency avg (ms)",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
      "targets": [
        {
          "expr": "sum(rate(tas_rinhaback_3ed_prom_ex_plug_router_http_request_duration_milliseconds_sum[1m])) / sum(rate(tas_rinhaback_3ed_prom_ex_plug_router_http_request_duration_milliseconds_count[1m]))",
          "legendFormat": "avg"
        }
      ],
      "fieldConfig": {"defaults": {"unit": "ms", "decimals": 2}, "overrides": []}
    },
    {
      "type": "timeseries",
      "title": "HTTP error rate (4xx/5xx)",
      "gridPos": {"h": 7, "w": 8, "x": 0, "y": 8},
      "targets": [
        {
          "expr": "sum(rate(tas_rinhaback_3ed_prom_ex_plug_router_http_requests_total{status=~\"4..|5..\"}[1m]))",
          "legendFormat": "errors/s"
        }
      ],
      "fieldConfig": {"defaults": {"unit": "req/s"}, "overrides": []}
    },
    {
      "type": "stat",
      "title": "Queue length",
      "gridPos": {"h": 7, "w": 8, "x": 8, "y": 8},
      "options": {"reduceOptions": {"calcs": ["lastNotNull"], "values": false}, "orientation": "horizontal"},
      "targets": [
        {"expr": "tas_rinhaback_3ed_prom_ex_queue_length", "instant": true, "legendFormat": "len"}
      ],
      "fieldConfig": {"defaults": {"unit": "short"}, "overrides": []}
    },
    {
      "type": "stat",
      "title": "In-flight workers",
      "gridPos": {"h": 7, "w": 8, "x": 16, "y": 8},
      "options": {"reduceOptions": {"calcs": ["lastNotNull"], "values": false}, "orientation": "horizontal"},
      "targets": [
        {"expr": "tas_rinhaback_3ed_prom_ex_queue_in_flight", "instant": true, "legendFormat": "in_flight"}
      ],
      "fieldConfig": {"defaults": {"unit": "short"}, "overrides": []}
    },
    {
      "type": "timeseries",
      "title": "Queue enqueues vs drops (rate)",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 15},
      "targets": [
        {"expr": "rate(tas_rinhaback_3ed_prom_ex_queue_enqueued_total[1m])", "legendFormat": "enqueued/s"},
        {"expr": "rate(tas_rinhaback_3ed_prom_ex_queue_dropped_total[1m])", "legendFormat": "dropped/s"}
      ],
      "fieldConfig": {"defaults": {"unit": "1/s"}, "overrides": []}
    },
    {
      "type": "timeseries",
      "title": "Job duration avg (ms) by result",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 15},
      "targets": [
        {
          "expr": "sum by (result) (rate(tas_rinhaback_3ed_prom_ex_queue_job_duration_milliseconds_sum[1m])) / sum by (result) (rate(tas_rinhaback_3ed_prom_ex_queue_job_duration_milliseconds_count[1m]))",
          "legendFormat": "{{result}}"
        }
      ],
      "fieldConfig": {"defaults": {"unit": "ms", "decimals": 2}, "overrides": []}
    },
    {
      "type": "timeseries",
      "title": "Queue wait time avg (ms)",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 23},
      "targets": [
        {
          "expr": "sum(rate(tas_rinhaback_3ed_prom_ex_queue_wait_time_milliseconds_sum[1m])) / sum(rate(tas_rinhaback_3ed_prom_ex_queue_wait_time_milliseconds_count[1m]))",
          "legendFormat": "avg"
        }
      ],
      "fieldConfig": {"defaults": {"unit": "ms", "decimals": 2}, "overrides": []}
    }
  ],
  "refresh": "10s",
  "schemaVersion": 37,
  "style": "dark",
  "tags": ["tas", "rinha", "queue", "http"],
  "templating": {"list": []},
  "time": {"from": "now-15m", "to": "now"},
  "timepicker": {"refresh_intervals": ["2s", "5s", "10s", "30s", "1m", "5m"]},
  "timezone": "",
  "title": "Tas Rinhaback â€” API & Queue",
  "version": 1,
  "weekStart": ""
}
